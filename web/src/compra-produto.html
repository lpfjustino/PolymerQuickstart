<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">

<link rel="import" href="shared-styles.html">
<!--<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">-->

<!-- include classes in the main document -->

<dom-module id="compra-produto">
	<template>
	<style include="shared-styles">

		:host {
		display: block;

		padding: 10px;
		}
		<style is="custom-style" include="iron-flex iron-flex-alignment">
		

	
	</style>
	
	
		<iron-ajax auto url="http://127.0.0.1:3001/products" handle-as="json" last-response="{{ajaxResponse}}"></iron-ajax>
			<div id="pcId" layout horizontal wrap>
		    <template is="dom-repeat" items="[[ajaxResponse]]" index-as="i">
		    
			    <div class = "card">
			    	<div>
				    	<img class="group list-group-image" src = {{item.img_produto}} alt="" />
				    </div>
		            <span>{{item.nome_produto}}</span>
		            <div>
		            	<p>Descrição:<br>{{item.descricao}}</p>
					</div>
					<div>
						<p>R$ {{item.preco}}
					</div>

					<paper-input  label="Quantidade" value= "{{item.i.amount}}"></paper-input>
					<paper-button raised="" on-tap = "to_Cart" data-args = "item.i" class="indigo" role="button" tabindex="0" animated="" elevation="1" aria-disabled="false">Adicionar ao Carrinho</paper-button>
	            </div>	
        	</template>
        	</div>
	
	
	</template>

	<script>
	//value = {{amount}}
	class CompraProduto extends Polymer.Element {
		static get is() { return 'compra-produto'; }

		static get properties() {
			return {
				amount: Number,
				//TENTEI FAZER UM VETOR DE AMOUNT AQUI EMBAIXO, AÍ FICA UM AMOUNT PRA CADA INPUT, ANTES TAVA SÓ UM NUMBER
				// SÓ QUE DAÍ TERIA O PROBLEMA DE TER ITEM.I.AMOUNT.I, PQ TEM UM OBSERVER PRA CADA AMOUNT... DEFINIDO AQUI EMBAIXO TB
				/*
				amount: { 
					type: Array,
					value: [],
				},
				*/

				//observer que vi no stackoverflow
				observers: ['onInputChange(*.amount)'],
				//isso aqui era o vetor de amount na real que eu tava usando, mas acredito que só o vetor amount seja o suficiente, só to mantendo
				//aqui pq tava funcionando gambiarradamente (o que mostrei pra ti e pro boss)
				items_in_cart: {
					type: Array,
					value: []
				}
				
				
			};
		}
		//essa função retorna o json do item inserido no carrinho
		onInputChange(changedInput) {console.log(changedInput);}
		to_Cart(e) {
			//console.log(this.$.pcId.querySelector(All('paper-input').value));
			//console.log(e.target);
			//se não está no carrinho e a qtdade for valida
			console.log(e.path[0].getAttribute('data-args'));
			//console.log(Polymer.dom(e).path[0].getAttribute('data-args').amount);
			if(this.items_in_cart[e.model.item.id] == null && e.model.amount > 0) {
				//coloco no carrinho
				this.items_in_cart[e.model.item.id] = e.model.amount;
				let item = JSON.stringify(e.model.item);
				console.log(item);
				//retorno o item
				return item;
			}
			else {
				if(this.items_in_cart[e.model.item.id] > 0)
					alert("Esse item já está no carrinho!")
				if(isNaN(e.model.amount) || e.model.amount <= 0)
					alert("Insira uma quantidade válida!");
			}
		}
	}
	window.customElements.define(CompraProduto.is, CompraProduto);
	</script>
</dom-module>
