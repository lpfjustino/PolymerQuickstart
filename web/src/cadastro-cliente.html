<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="shared-styles.html">

<dom-module id="cadastro-cliente">
	<template>
	<style include="shared-styles">
		:host {
		display: block;

		padding: 10px;
		}
	</style>

	<div class="container-fluid">
		<div class="row">
		<div class="col-md-12">
			<h3>
			Novo Cliente
			</h3>
			<p>
			Insira as informações do novo cliente a ser cadastrado.
			</p>
			<form role="form">

			<!-- ID -->
			<div class="form-group">
				<label for="input_name">
				Código do cliente
				</label>
				<input type="text" class="form-control" id="input_id"/>
			</div>
			
			<!-- Nome -->
			<div class="form-group">
				<label for="input_name">
				Nome Completo
				</label>
				<input type="text" class="form-control" id="input_name" />
			</div>

			<!-- Endereço -->
			<div class="form-group">
				<label for="input_address">
				Endereço
				</label>
				<input type="text" class="form-control" id="input_address" />
			</div>

			<!-- Telefone -->
			<div class="form-group">
				<label for="input_phone">
				Telefone
				</label>
				<input type="text" class="form-control" id="input_phone" />
			</div>

			<!-- Email -->
			<div class="form-group">
				<label for="input_email">
				Email
				</label>
				<input type="text" class="form-control" id="input_email" />
			</div>
			
			<!-- Foto -->
			<div class="form-group">
				<label for="input_photo">
				Foto
				</label>
				<input type="file" id="input_photo" />
				<p class="help-block">
				Insira aqui a foto do cliente.
				</p>
			</div>

			<paper-button raised class="primary" on-tap="postRegister">Cadastrar</paper-button>
			</form>
		</div>
		</div>
	</div>
	</template>

	<script>
	class CadastroCliente extends Polymer.Element {
		static get is() { return 'cadastro-cliente'; }

		postRegister() {
			this.$.registerLoginAjax.url = 'http://localhost:3001/users';
			this._setReqBody();
			this.$.registerLoginAjax.generateRequest();
		}

		_setReqBody() {
			this.$.registerLoginAjax.body = this.formData;
		}

		handleUserResponse(event) {
			var response = JSON.parse(event.detail.response);
	
			if (response.id_token) {
				this.error = '';
				this.storedUser = {
					name: this.formData.username,
					id_token: response.id_token,
					access_token: response.access_token,
					role: response.role,
					loggedin: true
				};

				this.redirect();
			}

			// reset form data
			this.formData = {};
		}

		handleUserError(event) {
			this.error = event.detail.request.xhr.response;
		}
	}

	window.customElements.define(CadastroCliente.is, CadastroCliente);
	</script>
</dom-module>
